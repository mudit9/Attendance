import urllib
import argparse
import time
import mechanicalsoup
from time import gmtime, strftime
from urllib.request import urlopen
from selenium import webdriver
#driver = webdriver.Chrome()
driver = webdriver.Chrome("/usr/lib/chromium-browser/chromedriver")


#def getWebSource(n, url, seconds, times):
#    while n < times:
#        usock = urlopen(url)
#        data = usock.read()
#        usock.close()
#        fout = open("WebData.txt", "w")
        # currentTime = strftime("%Y-%m-%d %H:%M:%S", gmtime())
        # fout.write(str(currentTime))
        # fout.write(str(data))
        # fout.write("\n\n")
#        print(n)
#        n = n + 1
#        print(str(data))

#        time.sleep(seconds)


#n = 0
#seconds = 5
#times = 4
# url=

# parser = argparse.ArgumentParser()
# parser.add_argument("username")
# parser.add_argument("password")
# args = parser.parse_args()
browser = mechanicalsoup.Browser()
login_page = browser.get("https://markattendance.webapps.snu.edu.in/public/application/login/login")
login_form = login_page.soup.select("form")[0]
login_form.select("#login_user_name")[0]['value'] = "ms418"
login_form.select("#login_password")[0]['value'] = "Rakhi@17"
# to test initiation.
while 1:
    page2 = browser.submit(login_form, login_page.url)
    print(page2.soup.title.text)
    time.sleep(5)
    page3 = browser.submit(login_form, login_page.url)
    print(page3.soup.title.text)
    if (page2.soup.text != page3.soup.text):
        print("Initiated! ")
        driver.get("https://markattendance.webapps.snu.edu.in/public/application/index/index")
        ele= driver.find_element_by_link_text("Submit")
        ele.click()
        break

# print(page2.soup.title.text)
#page3 = browser.get("https://markattendance.webapps.snu.edu.in/public/application/index/summary")
#print(page3.soup.text)

# submit button id= btn btn-success btn-block

